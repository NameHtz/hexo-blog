---
title: 架构、研发
tags: web
---

[本问题在 GitHub](https://github.com/vianvio/FE-Companions/issues/75) 防止问题被删，直接搬来的，侵立删

问题列表：

1. 团队代码质量如何保障？从以下几个方面展开
   a. 如何确保有效的code review，而不是随便扫一眼？
   b. 线上发布规范如何系统化治理？
   c. 线上故障如何快速响应并定位？
2. 目前团队的研发体系具体做了哪些系统化的能力？最终态应该是怎样的？

##### 回答：

1. 团队代码质量如何保障?

   a. 如何确保有效的code review，而不是随便扫一眼？

   答: 对于代码审查这个环境，我们团队现阶段做的还不那么严格，主要还是跟团队的任务安排和时间有关，不过我也思考过怎么样做更好，后面打算引入到团队里面来。

   - 首先是建立起代码审查的规范，我认为先把一些常规的规范建立起来，从代码规范和架构规范入手，来约束团队的代码风格，在代码审查的时候可以按照代码的规范做初步的审查，比如我们Web端是有个基本的业务框架的，在这个业务框架下，基本能满足大部分的需求的，同时也有代码规范来约束团队成员的代码，相当于从源头上做了一次筛选
   - 接着是建立代码审查Check List，列出常见的不规范代码，列出常见的逻辑错误，常见的常识性错误等，团队成员按照Check List 来作基本审查，这样基本可以确保大部分的代码质量是合格的
   - 然后团队成员花时间互相审查，可以借助一些代码审查工具来审查代码，在这一环节，成员之间可以提出一些代码优化的建议，要求开发者按照优化的建议优化完代码之后，同时要求所有核心成员之间审查没问题了，方可合并入开发主分支，当前这个环节主要还是我个人在把关，主要还是时间原因，没能做的那么细致

以上是我认为的几个关键环节。

b. 线上发布规范如何系统化治理？
答: 线上发布规范我认为可以分为三个阶段，发布前，发布中和发布后

1. 对于应用发布前，首先需要的是对功能的系统化测试，确保发布前没有严重或致命性的bug；再就是同样可以编写一个Check List，来检查发布前，各个方面是否都已经准备充分，比如部署环境是否准备就绪，后台业务接口是否已经达到发布的要求，发布前的版本管理，CI和CD是否能正常工作，确定需要发布哪些模块和发布的时间节点等
2. 对于应用发布中，我们需要考虑错峰发布，还要考虑发布资源和页面的CDN配置，缓存配置，按需加载，更新资源发布路径实现平滑升级等。在发布过程中，除了保障迭代顺利发布，同时还要保证在发布的过程中，避免影响上一迭代的发布内容，这一方面，需要依赖增量发布，可以通过Wepback和Gulp等构建工具来进行发布资源的管理
3. 对于应用发布后，我们需要保证应用的能持续稳定的运行，一旦发现发布的版本出现问题，尽可能马上安排人员进行热修复，对于出现致命问题，可能需要终止发布，回朔到上一版本，确保不影响用户功能体验

对于这三个阶段，每个阶段均可以出更具体的解决方案，针对可能出现的问题一一制定对策，每个阶段的方案互相配合，保证线上发布整个过程顺利完成

c. 线上故障如何快速响应并定位？
答: 发布到线上可能会出现一些bug，对于线上出现的bug，我们如何快速应对呢。首先，我们在项目初始阶段，做好全局错误监听工程，这里可以接入阿里云的日志服务，把前端出现的任何异常，上报至阿里云，通过查找日志，基本上可以定位绝大部分的错误。定位到问题点的之后，安排成员从发布分支切热修复分支修复问题，安排测试人员测试问题是否修复，确保修复完毕之后，再次选择增量发布该模块

1. 目前团队的研发体系具体做了哪些系统化的能力？最终态应该是怎样的？
   1. 首先我们已经建立起了一套Web端的代码规范，系统的配置了TSlint代码检查机制，来约束成员的代码风格，其次，当团队成员没有按照既定的规范编写代码时，在提交代码时，会有相应的TSlint报错，阻止成员提交不合规范的代码
   2. Web端对全局通用的组件建立了组件库，我们用Storyboard来开发通用组件库，同时编写组件测试用例和组件说明文档，组件库通过测试后，便可发布至线上。团队成员可以访问组件库添加的组件，也可以实际体验组件的功能，在引入组件库的过程中，可以阅读相应的文档说明.
   3. 对于模块组件和工具函数，我们建立了相应的测试规范，团队成员需要编写组件测试用例，且在提交代码的时候，只有所有的测试用例通过之后，才能提交至远程分支，不过当前阶段，我们的测试覆盖率还未达到要求，主要原因是我们没有太多时间去对所有的组件编写测试，后面争取能提高测试覆盖率
   4. 对于代码提交阶段，做了全局的限制，主要包含测试，代码检查和git 提交信息的规范，测试和代码检查前面有提及，对于gi t，我们明确要求，只有commit 信息满足`feat`, `fix`, `refactor`, `docs`, `style`, `test`, 'chore' 这7个关键字开头，才能提交。规范了commit信息后，可以直接用工具生成相应的CHANGELOG.md日志，然后对外发布迭代内容
   5. 对于页面开发，我们规定了全局统一使用React Loadable动态引入页面，便于Webpack代码分割，也满足了按需加载的要求，我们的页面模块相对简单，但是页面数量多，所以用了代码分割后，页面加载响应很快，加载的资源文件也不会很大

我们当前纯Web端团队人数不多，加上我就3人，移动端人数多一点，所以Web端的工程化做的还不是很到位，比如增量更新，灰度发布等，我们还没有具体实现，因为我们是后台管理系统，用户也不是很多，当前本人还要负责移动端Flutter App的工作，所以当前这方面还很欠缺。感谢大佬抽出时间给予指导🙏



